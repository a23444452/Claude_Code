# Dataset Quality Guard Plugin

## Description
è³‡æ–™é›†å“è³ªå®ˆè¡›ï¼Œè‡ªå‹•æª¢æŸ¥ YOLO æ ¼å¼è³‡æ–™é›†çš„å®Œæ•´æ€§ã€æ­£ç¢ºæ€§å’Œå“è³ªå•é¡Œï¼Œç¢ºä¿è¨“ç·´å‰è³‡æ–™æº–å‚™å®Œå–„ã€‚

## Capabilities
- âœ… YOLO æ ¼å¼é©—è­‰ï¼ˆclass_id x y w hï¼‰
- ğŸ“Š é¡åˆ¥åˆ†å¸ƒåˆ†æå’Œä¸å¹³è¡¡åµæ¸¬
- ğŸ” æ¨™è¨»éŒ¯èª¤æª¢æ¸¬ï¼ˆåº§æ¨™è¶…å‡ºç¯„åœã€ç„¡æ•ˆå€¼ï¼‰
- ğŸ“ æª”æ¡ˆå®Œæ•´æ€§æª¢æŸ¥ï¼ˆåœ–ç‰‡-æ¨™è¨»å°æ‡‰ï¼‰
- ğŸ¨ åœ–ç‰‡å“è³ªè©•ä¼°
- ğŸ’¡ æ”¹é€²å»ºè­°å’Œæœ€ä½³å¯¦è¸

## When to Use
- âœ… è¨“ç·´å‰å¿…é ˆåŸ·è¡Œ
- âœ… æ–°å¢è³‡æ–™å¾Œé©—è­‰
- âœ… ä¿®æ”¹æ¨™è¨»å¾Œç¢ºèª
- âœ… è³‡æ–™é›†æ•´åˆå¾Œæª¢æŸ¥
- âœ… è¨“ç·´æ•ˆæœä¸ä½³æ™‚æ’æŸ¥

## Usage

### Example 1: åŸºæœ¬é©—è­‰
```
User: å¹«æˆ‘æª¢æŸ¥è³‡æ–™é›† config/data.yaml

Plugin Response:
åŸ·è¡Œè³‡æ–™é›†é©—è­‰...

âœ… **é…ç½®æª¢æŸ¥**
- æ‰¾åˆ° config/data.yaml
- å¿…è¦æ¬„ä½å®Œæ•´ (path, train, val, names, nc)

âœ… **è·¯å¾‘æª¢æŸ¥**
- åŸºç¤è·¯å¾‘å­˜åœ¨: /path/to/YOLO_Project
- è¨“ç·´é›†è·¯å¾‘: dataset/my_dataset/images/train (âœ“)
- é©—è­‰é›†è·¯å¾‘: dataset/my_dataset/images/val (âœ“)

ğŸ“Š **æª”æ¡ˆçµ±è¨ˆ**
- è¨“ç·´é›†: 850 å¼µåœ–ç‰‡
- é©—è­‰é›†: 200 å¼µåœ–ç‰‡
- ç¸½è¨ˆ: 1050 å¼µåœ–ç‰‡

âœ… **æ¨™è¨»æª¢æŸ¥**
- æª¢æŸ¥ 850 å€‹è¨“ç·´æ¨™è¨»æª”æ¡ˆ
- ç™¼ç¾ 3 å€‹ç¼ºå°‘æ¨™è¨»çš„åœ–ç‰‡
- ç™¼ç¾ 2 å€‹æ¨™è¨»æ ¼å¼éŒ¯èª¤

âš ï¸ **å•é¡Œè©³æƒ…**:

ç¼ºå°‘æ¨™è¨»çš„åœ–ç‰‡:
- IMG_001.jpg
- IMG_045.jpg
- IMG_089.jpg

æ¨™è¨»æ ¼å¼éŒ¯èª¤:
- IMG_023.txt: Line 2: x=1.05 è¶…å‡ºç¯„åœ [0, 1]
- IMG_067.txt: Line 1: åƒ… 4 å€‹å€¼ï¼ŒæœŸæœ› 5 å€‹

ğŸ“Š **é¡åˆ¥åˆ†å¸ƒ**:
```
Class 0 (helmet):     680 (68%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Class 1 (no_helmet):  320 (32%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
```

âš ï¸ **é¡åˆ¥ä¸å¹³è¡¡**: ratio 2.1:1
å»ºè­°: è€ƒæ…®è³‡æ–™å¢å¼·æˆ–åŠ æ¬Šæå¤±

ğŸ” **å»ºè­°**:
1. è£œå……ç¼ºå°‘çš„ 3 å€‹æ¨™è¨»æª”æ¡ˆ
2. ä¿®æ­£ 2 å€‹æ¨™è¨»æ ¼å¼éŒ¯èª¤
3. è€ƒæ…®æ”¶é›†æ›´å¤š "no_helmet" æ¨£æœ¬ä»¥å¹³è¡¡é¡åˆ¥
4. ä½¿ç”¨è³‡æ–™å¢å¼·ç·©è§£ä¸å¹³è¡¡å•é¡Œ
```

### Example 2: é¡åˆ¥åˆ†å¸ƒåˆ†æ
```
User: åˆ†ææˆ‘çš„è³‡æ–™é›†é¡åˆ¥åˆ†å¸ƒ

Plugin Response:
ğŸ“Š **è©³ç´°é¡åˆ¥åˆ†å¸ƒåˆ†æ**

è¨“ç·´é›† (850 images, 1000 annotations):
```
Class ID | Name        | Count | Percentage | Bar
---------|-------------|-------|------------|-----------------------------
0        | person      | 450   | 45.0%      | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
1        | car         | 300   | 30.0%      | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
2        | bike        | 150   | 15.0%      | â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
3        | truck       | 80    | 8.0%       | â–ˆâ–ˆâ–ˆâ–ˆ
4        | bus         | 20    | 2.0%       | â–ˆ
```

é©—è­‰é›† (200 images, 240 annotations):
```
Class ID | Name        | Count | Percentage
---------|-------------|-------|------------
0        | person      | 110   | 45.8%
1        | car         | 70    | 29.2%
2        | bike        | 35    | 14.6%
3        | truck       | 18    | 7.5%
4        | bus         | 7     | 2.9%
```

âš ï¸ **ä¸å¹³è¡¡è­¦å‘Š**:
- Class 4 (bus) åƒ…æœ‰ 2% æ¨£æœ¬ (20 å€‹)
- æœ€å¤§/æœ€å°æ¯”ä¾‹: 22.5:1 (person vs bus)

ğŸ’¡ **å»ºè­°**:
1. **æ”¶é›†æ›´å¤šè³‡æ–™**: bus é¡åˆ¥éœ€è¦è‡³å°‘ 100 å€‹æ¨£æœ¬
2. **éæ¡æ¨£**: è¤‡è£½å°‘æ•¸é¡åˆ¥åœ–ç‰‡ä¸¦æ‡‰ç”¨å¢å¼·
3. **åŠ æ¬Šæå¤±**: å¢åŠ å°‘æ•¸é¡åˆ¥çš„æ¬Šé‡
4. **åˆä½µé¡åˆ¥**: è€ƒæ…®å°‡ truck å’Œ bus åˆä½µç‚º "large_vehicle"

å¯¦ä½œç¯„ä¾‹:
```python
# ä½¿ç”¨é¡åˆ¥æ¬Šé‡
model.train(
    data='data.yaml',
    # å°‘æ•¸é¡åˆ¥æ¬Šé‡è¼ƒé«˜
    class_weights=[1.0, 1.0, 1.0, 2.0, 5.0]
)
```
```

### Example 3: æ¨™è¨»éŒ¯èª¤ä¿®æ­£
```
User: ç™¼ç¾æ¨™è¨»æœ‰å•é¡Œï¼Œæ€éº¼ä¿®æ­£ï¼Ÿ

Plugin Response:
ç™¼ç¾ä»¥ä¸‹æ¨™è¨»éŒ¯èª¤éœ€è¦ä¿®æ­£ï¼š

ğŸ”§ **éŒ¯èª¤é¡å‹ 1: åº§æ¨™è¶…å‡ºç¯„åœ**
æª”æ¡ˆ: dataset/labels/train/IMG_023.txt
Line 2: `0 1.05 0.5 0.3 0.2`
å•é¡Œ: x=1.05 > 1.0 (è¶…å‡ºç¯„åœ)

ä¿®æ­£æ–¹æ³•:
```python
# æ‰‹å‹•ä¿®æ­£
# åŸå§‹: 0 1.05 0.5 0.3 0.2
# ä¿®æ­£: 0 0.95 0.5 0.3 0.2 (è£åˆ‡åˆ°é‚Šç•Œ)

# æˆ–æ‰¹æ¬¡ä¿®æ­£è…³æœ¬
import glob

for label_file in glob.glob('dataset/labels/train/*.txt'):
    with open(label_file, 'r') as f:
        lines = f.readlines()

    fixed_lines = []
    for line in lines:
        parts = line.strip().split()
        if len(parts) == 5:
            cls, x, y, w, h = parts
            x, y, w, h = map(float, [x, y, w, h])
            # è£åˆ‡åˆ° [0, 1]
            x = max(0, min(1, x))
            y = max(0, min(1, y))
            w = max(0, min(1, w))
            h = max(0, min(1, h))
            fixed_lines.append(f"{cls} {x} {y} {w} {h}\n")

    with open(label_file, 'w') as f:
        f.writelines(fixed_lines)
```

ğŸ”§ **éŒ¯èª¤é¡å‹ 2: æ ¼å¼ä¸å®Œæ•´**
æª”æ¡ˆ: dataset/labels/train/IMG_067.txt
Line 1: `0 0.5 0.5 0.3` (åƒ… 4 å€‹å€¼)
å•é¡Œ: ç¼ºå°‘é«˜åº¦å€¼

ä¿®æ­£æ–¹æ³•:
1. å›åˆ°æ¨™è¨»å·¥å…·é‡æ–°æ¨™è¨»
2. æˆ–åˆªé™¤è©²æ¨™è¨»è¡Œï¼ˆå¦‚æœç„¡æ³•æ¢å¾©ï¼‰

ğŸ”§ **éŒ¯èª¤é¡å‹ 3: ç„¡æ•ˆçš„é¡åˆ¥ ID**
æª”æ¡ˆ: dataset/labels/train/IMG_089.txt
Line 3: `5 0.5 0.5 0.3 0.2`
å•é¡Œ: é¡åˆ¥ ID 5 è¶…å‡ºç¯„åœ (æ‡‰ç‚º 0-4)

ä¿®æ­£æ–¹æ³•:
æª¢æŸ¥ data.yaml çš„ nc è¨­å®šæ˜¯å¦æ­£ç¢ºï¼Œæˆ–ä¿®æ­£æ¨™è¨»ã€‚

åŸ·è¡Œé©—è­‰ç¢ºèª:
```bash
python scripts/validate_dataset.py config/data.yaml -v
```
```

## Validation Rules

### YOLO æ ¼å¼è¦ç¯„
```
class_id x_center y_center width height
```

**è¦æ±‚**:
- `class_id`: æ•´æ•¸ï¼Œç¯„åœ [0, nc-1]
- `x_center, y_center, width, height`: æµ®é»æ•¸ï¼Œç¯„åœ [0, 1]
- åº§æ¨™å·²æ­¸ä¸€åŒ–ï¼ˆç›¸å°æ–¼åœ–ç‰‡å¤§å°ï¼‰
- æ¯è¡Œä¸€å€‹æ¨™è¨»
- ç©ºç™½è¡Œå¿½ç•¥

### æª”æ¡ˆçµæ§‹è¦æ±‚
```
dataset/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ train/
â”‚   â”‚   â””â”€â”€ *.jpg
â”‚   â””â”€â”€ val/
â”‚       â””â”€â”€ *.jpg
â””â”€â”€ labels/
    â”œâ”€â”€ train/
    â”‚   â””â”€â”€ *.txt
    â””â”€â”€ val/
        â””â”€â”€ *.txt
```

### é¡åˆ¥åˆ†å¸ƒå»ºè­°
- **ç†æƒ³**: å„é¡åˆ¥æ¨£æœ¬æ•¸ç›¸è¿‘ (ratio < 2:1)
- **å¯æ¥å—**: ratio 2-5:1
- **éœ€æ³¨æ„**: ratio 5-10:1ï¼ˆè€ƒæ…®åŠ æ¬Šæˆ–å¢å¼·ï¼‰
- **æœ‰å•é¡Œ**: ratio > 10:1ï¼ˆå¼·çƒˆå»ºè­°å¹³è¡¡ï¼‰

### æœ€å°æ¨£æœ¬æ•¸å»ºè­°
- **æ¯é¡åˆ¥**: è‡³å°‘ 50-100 å€‹æ¨£æœ¬
- **ç¸½è¨“ç·´é›†**: è‡³å°‘ 300-500 å¼µåœ–ç‰‡
- **é©—è­‰é›†**: è¨“ç·´é›†çš„ 15-20%

## Best Practices

### è³‡æ–™æ”¶é›†
- âœ… æ¶µè“‹å„ç¨®å ´æ™¯ï¼ˆå…‰ç·šã€è§’åº¦ã€è·é›¢ï¼‰
- âœ… åŒ…å«å›°é›£æ¨£æœ¬ï¼ˆé®æ“‹ã€å°ç‰©ä»¶ï¼‰
- âœ… ç¢ºä¿é¡åˆ¥å¹³è¡¡
- âœ… é¿å…é‡è¤‡æˆ–ç›¸ä¼¼åœ–ç‰‡

### æ¨™è¨»å“è³ª
- âœ… Bounding box ç·Šå¯†åŒ…åœç‰©ä»¶
- âœ… é®æ“‹ç‰©ä»¶åªæ¨™è¨»å¯è¦‹éƒ¨åˆ†
- âœ… å°ç‰©ä»¶ä¹Ÿè¦æ¨™è¨»
- âœ… é¡åˆ¥æ¨™ç±¤æ­£ç¢ºä¸€è‡´

### è³‡æ–™åˆ†å‰²
- âœ… éš¨æ©Ÿåˆ†å‰²ï¼ˆé¿å…æ™‚é–“æˆ–ç©ºé–“åå·®ï¼‰
- âœ… è¨“ç·´/é©—è­‰/æ¸¬è©¦ï¼š70/20/10 æˆ– 80/15/5
- âœ… ç¢ºä¿å„é›†åˆé¡åˆ¥åˆ†å¸ƒç›¸ä¼¼
- âœ… é©—è­‰é›†ä»£è¡¨å¯¦éš›æ‡‰ç”¨å ´æ™¯

## Integration Commands

### å¿«é€Ÿé©—è­‰
```bash
# åŸºæœ¬é©—è­‰
python scripts/validate_dataset.py config/data.yaml

# è©³ç´°é©—è­‰ï¼ˆé¡¯ç¤ºæ‰€æœ‰éŒ¯èª¤ï¼‰
python scripts/validate_dataset.py config/data.yaml -v

# æˆ–ä½¿ç”¨ Claude Code å‘½ä»¤
/dataset-analyzer --dataset config/data.yaml
```

### é…åˆå·¥ä½œæµç¨‹
```
1. æº–å‚™è³‡æ–™é›†
   â†“
2. åŸ·è¡Œ dataset-quality-guard é©—è­‰
   â†“
3. ä¿®æ­£ç™¼ç¾çš„å•é¡Œ
   â†“
4. é‡æ–°é©—è­‰ç›´åˆ°é€šé
   â†“
5. é–‹å§‹è¨“ç·´ (yolo-training-advisor)
```

## Common Issues & Solutions

### å•é¡Œ 1: ç¼ºå°‘æ¨™è¨»æª”æ¡ˆ
**ç—‡ç‹€**: åœ–ç‰‡å­˜åœ¨ä½† .txt ä¸å­˜åœ¨
**åŸå› **: æ¨™è¨»å·¥å…·æœªå„²å­˜æˆ–æª”æ¡ˆéºå¤±
**è§£æ±º**: ä½¿ç”¨æ¨™è¨»å·¥å…·è£œå……æ¨™è¨»

### å•é¡Œ 2: åº§æ¨™è¶…å‡ºç¯„åœ
**ç—‡ç‹€**: x, y, w, h ä¸åœ¨ [0, 1] ç¯„åœ
**åŸå› **: æ¨™è¨»å·¥å…·åŒ¯å‡ºéŒ¯èª¤æˆ–æ‰‹å‹•ç·¨è¼¯éŒ¯èª¤
**è§£æ±º**: ä½¿ç”¨è…³æœ¬æ‰¹æ¬¡ä¿®æ­£ï¼ˆè¦‹ä¸Šæ–¹ç¯„ä¾‹ï¼‰

### å•é¡Œ 3: é¡åˆ¥åš´é‡ä¸å¹³è¡¡
**ç—‡ç‹€**: ratio > 10:1
**åŸå› **: è³‡æ–™æ”¶é›†åå·®
**è§£æ±º**:
- æ”¶é›†æ›´å¤šå°‘æ•¸é¡åˆ¥è³‡æ–™
- ä½¿ç”¨è³‡æ–™å¢å¼·
- æ‡‰ç”¨é¡åˆ¥æ¬Šé‡
- è€ƒæ…®éæ¡æ¨£

### å•é¡Œ 4: æ¨£æœ¬æ•¸éå°‘
**ç—‡ç‹€**: ç¸½æ¨£æœ¬ < 300 æˆ–æŸé¡åˆ¥ < 50
**åŸå› **: è³‡æ–™æ”¶é›†ä¸è¶³
**è§£æ±º**: æ”¶é›†æ›´å¤šè³‡æ–™æˆ–ä½¿ç”¨é·ç§»å­¸ç¿’

## Output Format

### é©—è­‰å ±å‘Šçµæ§‹
```
âœ… Configuration Valid
ğŸ“Š File Statistics
âœ… Annotation Format Check
âš ï¸ Issues Found
ğŸ“Š Class Distribution
ğŸ’¡ Recommendations
```

### å•é¡Œåš´é‡ç¨‹åº¦
- ğŸ”´ **Critical**: å¿…é ˆä¿®æ­£æ‰èƒ½è¨“ç·´ï¼ˆæ ¼å¼éŒ¯èª¤ï¼‰
- ğŸŸ¡ **Warning**: å»ºè­°ä¿®æ­£ï¼ˆé¡åˆ¥ä¸å¹³è¡¡ï¼‰
- ğŸ”µ **Info**: åƒè€ƒè³‡è¨Šï¼ˆçµ±è¨ˆè³‡æ–™ï¼‰

## Version History
- v1.0.0: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æ´ YOLO æ ¼å¼é©—è­‰å’Œå“è³ªæª¢æŸ¥
