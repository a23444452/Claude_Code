# Claude Code Hooks

YOLO å°ˆæ¡ˆçš„è‡ªå‹•åŒ–æª¢æŸ¥å’Œé©—è­‰ hooksï¼Œåœ¨åŸ·è¡Œå‘½ä»¤å‰å¾Œæä¾›ä¿è­·å’Œå»ºè­°ã€‚

## Hooks åˆ—è¡¨

### ğŸ” [pre_train_validator.py](pre_train_validator.py)
**è¨“ç·´å‰é©—è­‰å™¨**

åœ¨åŸ·è¡Œè¨“ç·´å‰è‡ªå‹•æª¢æŸ¥ï¼š
- âœ… è³‡æ–™é›†ç›®éŒ„æ˜¯å¦å­˜åœ¨ä¸”éç©º
- âœ… é…ç½®æª”æ¡ˆæ˜¯å¦å·²æº–å‚™ï¼ˆé exampleï¼‰
- âœ… æ˜¯å¦æœ‰å…¶ä»–è¨“ç·´æ­£åœ¨é€²è¡Œ
- âœ… å¿…è¦çš„ä¾è³´å¥—ä»¶æ˜¯å¦å·²å®‰è£

**è§¸ç™¼æ¢ä»¶ï¼š**
åŸ·è¡ŒåŒ…å« `train.py`ã€`yolo train` çš„å‘½ä»¤æ™‚

**ç¯„ä¾‹è¼¸å‡ºï¼š**
```
ğŸ” åŸ·è¡Œè¨“ç·´å‰æª¢æŸ¥...

âœ… è³‡æ–™é›†: é€šé
âœ… é…ç½®æª”æ¡ˆ: é€šé
âœ… è¨“ç·´ç‹€æ…‹: é€šé
âœ… ä¾è³´å¥—ä»¶: é€šé

âœ… æ‰€æœ‰æª¢æŸ¥é€šéï¼Œé–‹å§‹è¨“ç·´ï¼
```

---

### ğŸ›¡ï¸ [git_commit_validator.py](git_commit_validator.py)
**Git Commit é©—è­‰å™¨**

åœ¨åŸ·è¡Œ `git commit` å‰æª¢æŸ¥æš«å­˜å€ï¼Œé˜²æ­¢æäº¤ï¼š
- âŒ æ¨¡å‹æ¬Šé‡æª”æ¡ˆ (*.pt)
- âŒ è³‡æ–™é›†åœ–ç‰‡å’Œæ¨™è¨»
- âŒ æœ¬åœ°é…ç½®æª”æ¡ˆï¼ˆé exampleï¼‰
- âŒ å¤§å‹æª”æ¡ˆ (>10MB)
- âŒ æ•æ„Ÿè³‡è¨Š (.env, secrets)
- ğŸ’¡ æé†’æ˜¯å¦éœ€è¦æ›´æ–° README.md

**è§¸ç™¼æ¢ä»¶ï¼š**
åŸ·è¡Œ `git commit` å‘½ä»¤æ™‚

**ç¯„ä¾‹è¼¸å‡ºï¼š**
```
ğŸ” åŸ·è¡Œ Git Commit æª¢æŸ¥...

ğŸ“ æª¢æŸ¥ 3 å€‹æš«å­˜æª”æ¡ˆ...

âœ… æ¨¡å‹æª”æ¡ˆ: é€šé
âŒ è³‡æ–™é›†æª”æ¡ˆ: å¤±æ•—
   ç™¼ç¾è³‡æ–™é›†æª”æ¡ˆï¼š
   dataset/MBB_Dataset/images/train/img001.jpg
   dataset/MBB_Dataset/labels/train/img001.txt

âš ï¸  è³‡æ–™é›†ä¸æ‡‰è©²è¢« commitï¼ˆå·²åœ¨ .gitignoreï¼‰
å»ºè­°ï¼šä½¿ç”¨ git restore --staged dataset/ å–æ¶ˆæš«å­˜
```

---

### ğŸš€ [api_startup_validator.py](api_startup_validator.py)
**API å•Ÿå‹•é©—è­‰å™¨**

åœ¨å•Ÿå‹• API æœå‹™å‰æª¢æŸ¥ï¼š
- âœ… API ä¸»æª”æ¡ˆæ˜¯å¦å­˜åœ¨
- âœ… æ¨¡å‹æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼ˆé è¨“ç·´æˆ–è¨“ç·´çš„ï¼‰
- âœ… ç«¯å£ 8000 æ˜¯å¦å¯ç”¨
- âœ… API ä¾è³´æ˜¯å¦å·²å®‰è£
- âš ï¸ CORS é…ç½®è­¦å‘Šï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰

**è§¸ç™¼æ¢ä»¶ï¼š**
åŸ·è¡ŒåŒ…å« `uvicorn`ã€`start_all.sh`ã€`/start-services` çš„å‘½ä»¤æ™‚

**ç¯„ä¾‹è¼¸å‡ºï¼š**
```
ğŸ” åŸ·è¡Œ API å•Ÿå‹•æª¢æŸ¥...

âœ… API æª”æ¡ˆ: é€šé
âœ… æ¨¡å‹æª”æ¡ˆ: é€šé
   æ‰¾åˆ°æ¨¡å‹ï¼šruns/train/exp/weights/best.pt
âœ… ç«¯å£å¯ç”¨æ€§: é€šé
âœ… API ä¾è³´: é€šé
âœ… CORS é…ç½®: é€šé

âš ï¸  è­¦å‘Šï¼šCORS é…ç½®å…è¨±æ‰€æœ‰ä¾†æº
   ç”Ÿç”¢ç’°å¢ƒå»ºè­°é™åˆ¶ç‰¹å®šåŸŸå
   åƒè€ƒï¼š/api-security é€²è¡Œå®‰å…¨æª¢æŸ¥

âœ… æ‰€æœ‰æª¢æŸ¥é€šéï¼Œå•Ÿå‹• API æœå‹™ï¼
```

---

### ğŸ’¡ [command_suggestion.py](command_suggestion.py)
**å‘½ä»¤å»ºè­°å™¨**

æä¾›æ›´å¥½çš„å‘½ä»¤å»ºè­°ï¼Œæ”¹å–„é–‹ç™¼é«”é©—ï¼š
- å»ºè­°ä½¿ç”¨ Claude Code commands æ›¿ä»£åŸå§‹å‘½ä»¤
- æé†’ä½¿ç”¨æ›´é«˜æ•ˆçš„å·¥å…·ï¼ˆGlob/Grep/Readï¼‰
- æä¾›æœ€ä½³å¯¦è¸å»ºè­°

**è§¸ç™¼æ¢ä»¶ï¼š**
ä»»ä½•å¯ä»¥æ”¹é€²çš„å‘½ä»¤

**ç¯„ä¾‹è¼¸å‡ºï¼š**
```
ğŸ’¡ æç¤ºï¼šæœ‰æ›´ç°¡å–®çš„æ–¹å¼åŸ·è¡Œæ­¤æ“ä½œï¼š

ğŸ“ ç•¶å‰å‘½ä»¤ï¼špython src/training/train.py --epochs 100
âœ¨ å»ºè­°ä½¿ç”¨ï¼š/train
ğŸ’¡ å„ªé»ï¼šClaude Code command æœƒè‡ªå‹•æª¢æŸ¥ç’°å¢ƒå’Œè³‡æ–™é›†

ï¼ˆç•¶å‰å‘½ä»¤ä»æœƒåŸ·è¡Œï¼Œä½†å»ºè­°ä¸‹æ¬¡ä½¿ç”¨æ¨è–¦çš„æ–¹å¼ï¼‰
```

## å•Ÿç”¨ Hooks

### æ–¹æ³• 1: åœ¨ Claude Code è¨­å®šä¸­å•Ÿç”¨

ç·¨è¼¯ `.claude/settings.json`ï¼š

```json
{
  "PreToolUse": [
    {
      "matcher": "Bash",
      "hooks": [
        {
          "type": "command",
          "command": "python3 .claude/hooks/pre_train_validator.py"
        },
        {
          "type": "command",
          "command": "python3 .claude/hooks/git_commit_validator.py"
        },
        {
          "type": "command",
          "command": "python3 .claude/hooks/api_startup_validator.py"
        },
        {
          "type": "command",
          "command": "python3 .claude/hooks/command_suggestion.py"
        }
      ]
    }
  ]
}
```

### æ–¹æ³• 2: å…¨åŸŸå•Ÿç”¨ï¼ˆæ‰€æœ‰å°ˆæ¡ˆï¼‰

ç·¨è¼¯ `~/.config/claude-code/settings.json` ä¸¦åŠ å…¥ç›¸åŒçš„é…ç½®ã€‚

## Hook åŸ·è¡Œæµç¨‹

```
ç”¨æˆ¶åŸ·è¡Œå‘½ä»¤
    â†“
Claude Code æº–å‚™åŸ·è¡Œ
    â†“
PreToolUse Hook è§¸ç™¼
    â†“
Hook è…³æœ¬åŸ·è¡Œæª¢æŸ¥
    â†“
    â”œâ”€ Exit Code 0 â†’ âœ… æª¢æŸ¥é€šéï¼Œç¹¼çºŒåŸ·è¡Œå‘½ä»¤
    â”œâ”€ Exit Code 1 â†’ âš ï¸ éŒ¯èª¤ï¼ˆåªé¡¯ç¤ºçµ¦ç”¨æˆ¶ï¼‰
    â””â”€ Exit Code 2 â†’ ğŸ›‘ é˜»æ­¢åŸ·è¡Œï¼Œé¡¯ç¤ºéŒ¯èª¤çµ¦ Claude
```

## Exit Code èªªæ˜

æ¯å€‹ hook ä½¿ç”¨æ¨™æº–çš„ exit code ä¾†æ§åˆ¶è¡Œç‚ºï¼š

| Exit Code | æ„ç¾© | è¡Œç‚º | ä½¿ç”¨å ´æ™¯ |
|-----------|------|------|---------|
| **0** | æª¢æŸ¥é€šé | å…è¨±å‘½ä»¤åŸ·è¡Œ | æ‰€æœ‰æª¢æŸ¥éƒ½é€šé |
| **1** | JSON éŒ¯èª¤ | é¡¯ç¤ºéŒ¯èª¤çµ¦ç”¨æˆ¶ | å…§éƒ¨éŒ¯èª¤ã€è§£æå¤±æ•— |
| **2** | é©—è­‰å¤±æ•— | é˜»æ­¢å‘½ä»¤åŸ·è¡Œ | ç™¼ç¾å•é¡Œã€ä¸ç¬¦åˆè¦ç¯„ |

## Hook è¼¸å…¥æ ¼å¼

æ¯å€‹ hook é€šé `stdin` æ¥æ”¶ JSON è¼¸å…¥ï¼š

```json
{
  "tool": {
    "name": "Bash",
    "input": {
      "command": "python src/training/train.py --epochs 100",
      "description": "Start model training"
    }
  }
}
```

## æœ€ä½³å¯¦è¸

### é–‹ç™¼éšæ®µ
1. **å•Ÿç”¨æ‰€æœ‰ hooks** - ç²å¾—æœ€å¤§çš„ä¿è­·å’Œå»ºè­°
2. **æ³¨æ„ hook è¼¸å‡º** - æä¾›æœ‰ç”¨çš„æ”¹é€²å»ºè­°
3. **éµå¾ªå»ºè­°** - ä½¿ç”¨æ¨è–¦çš„ commands å’Œå·¥å…·

### ç‰¹æ®Šæƒ…æ³
å¦‚æœç¢ºå®šè¦è·³é hook æª¢æŸ¥ï¼š
```bash
# ä½¿ç”¨ --no-verifyï¼ˆGit commitï¼‰
git commit --no-verify -m "message"

# æˆ–ç›´æ¥åŸ·è¡Œå‘½ä»¤ï¼ˆä¸é€é Claude Codeï¼‰
python src/training/train.py
```

### æ¸¬è©¦ Hook
å–®ç¨æ¸¬è©¦æŸå€‹ hookï¼š
```bash
echo '{"tool":{"name":"Bash","input":{"command":"python src/training/train.py"}}}' | \
  python3 .claude/hooks/pre_train_validator.py
```

## è‡ªè¨‚ Hook

### å‰µå»ºæ–°çš„ Hook

1. **å»ºç«‹ Python è…³æœ¬ï¼š**
```python
#!/usr/bin/env python3
import json
import sys

def main():
    try:
        input_data = json.loads(sys.stdin.read())
    except json.JSONDecodeError as e:
        print(f"éŒ¯èª¤: {e}", file=sys.stderr)
        sys.exit(1)

    command = input_data.get("tool", {}).get("input", {}).get("command", "")

    # ä½ çš„æª¢æŸ¥é‚è¼¯
    if some_check_fails:
        print("éŒ¯èª¤è¨Šæ¯", file=sys.stderr)
        sys.exit(2)  # é˜»æ­¢åŸ·è¡Œ

    sys.exit(0)  # å…è¨±åŸ·è¡Œ

if __name__ == "__main__":
    main()
```

2. **åŠ å…¥åˆ° settings.jsonï¼š**
```json
{
  "PreToolUse": [{
    "matcher": "Bash",
    "hooks": [{
      "type": "command",
      "command": "python3 .claude/hooks/your_hook.py"
    }]
  }]
}
```

3. **è³¦äºˆåŸ·è¡Œæ¬Šé™ï¼š**
```bash
chmod +x .claude/hooks/your_hook.py
```

## Hook é–‹ç™¼å»ºè­°

### è¼¸å‡ºæ ¼å¼
- âœ… ä½¿ç”¨æ¸…æ¥šçš„ emojiï¼ˆğŸ” âœ… âŒ âš ï¸ ğŸ’¡ï¼‰
- âœ… æä¾›å…·é«”çš„éŒ¯èª¤è¨Šæ¯å’Œå»ºè­°
- âœ… ä½¿ç”¨ `file=sys.stderr` è¼¸å‡ºè¨Šæ¯
- âœ… ä¿æŒç°¡æ½”ï¼Œé‡é»çªå‡º

### æ•ˆèƒ½è€ƒé‡
- âš¡ å¿«é€ŸåŸ·è¡Œï¼ˆ<1ç§’ï¼‰
- âš¡ é¿å…ä¸å¿…è¦çš„æª”æ¡ˆ I/O
- âš¡ åªåœ¨éœ€è¦æ™‚åŸ·è¡Œæ˜‚è²´çš„æª¢æŸ¥

### éŒ¯èª¤è™•ç†
- ğŸ›¡ï¸ å„ªé›…åœ°è™•ç†ä¾‹å¤–ç‹€æ³
- ğŸ›¡ï¸ ä¸æ‡‰è©²å› ç‚º hook å¤±æ•—è€Œä¸­æ–·æ­£å¸¸å·¥ä½œæµç¨‹
- ğŸ›¡ï¸ æä¾›æœ‰ç”¨çš„é™¤éŒ¯è³‡è¨Š

## ç–‘é›£æ’è§£

### Hook æ²’æœ‰åŸ·è¡Œ
1. æª¢æŸ¥ `settings.json` é…ç½®æ˜¯å¦æ­£ç¢º
2. ç¢ºèª hook æª”æ¡ˆæœ‰åŸ·è¡Œæ¬Šé™
3. æ¸¬è©¦ hook æ˜¯å¦å¯ä»¥å–®ç¨åŸ·è¡Œ

### Hook ç¸½æ˜¯å¤±æ•—
1. å–®ç¨åŸ·è¡Œ hook ä¸¦æŸ¥çœ‹è¼¸å‡º
2. æª¢æŸ¥ JSON è¼¸å…¥æ ¼å¼æ˜¯å¦æ­£ç¢º
3. ç¢ºèªæ‰€æœ‰ä¾è³´éƒ½å·²å®‰è£

### æƒ³è¦æš«æ™‚åœç”¨ Hook
1. è¨»è§£æ‰ `settings.json` ä¸­çš„å°æ‡‰é…ç½®
2. æˆ–ä½¿ç”¨ `--no-verify`ï¼ˆGitï¼‰

## ç›¸é—œè³‡æº

- [Claude Code å®˜æ–¹æ–‡æª”](https://code.claude.com/docs)
- [Hooks ç¯„ä¾‹](https://github.com/anthropics/claude-code/tree/main/examples/hooks)
- [å°ˆæ¡ˆé–‹ç™¼è¦ç¯„](../../CLAUDE.md)

---

**æç¤ºï¼š** Hooks æ˜¯æå‡é–‹ç™¼é«”é©—çš„å¼·å¤§å·¥å…·ï¼Œä½†ä¸æ‡‰è©²éåº¦ä½¿ç”¨ã€‚åªåœ¨çœŸæ­£éœ€è¦ä¿è­·æˆ–å»ºè­°çš„åœ°æ–¹ä½¿ç”¨ hooksã€‚
